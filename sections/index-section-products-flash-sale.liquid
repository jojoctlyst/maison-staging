{%- assign item = section.settings -%}

{%- assign grid = item.items -%}
{%- assign name_collection = item.collection -%}
{%- if name_collection == blank -%}{%- assign name_collection = "all" -%}{%- endif -%}
{%- assign collection = collections[name_collection] -%}
{%- assign length = item.limit | plus: 0 -%}

<div id="product-collection-{{ section.id }}" class="flash-sale-collection {% if item.top_offset == 'none' %}nomargin {% elsif item.top_offset == 'small' %}tt-offset-small {% endif %}container-indent {{ item.custom_classes }}">
  {% if item.nopaddings %}<div class="nopaddingspr">{% endif %}
  <div class="container{% if item.fullwidth %}-fluid-custom{% endif %} container-fluid-custom-mobile-padding" data-sectionname="index_sectionproducts">
    {%- if item.show_title -%}
      <div class="custom-block-title tt-block-title{% if item.title_to_left %} text-left{% endif %}{% if item.boxed_title and item.fullwidth %} container{% endif %}">
        <div style="width: 100%;">
          <h2 class="tt-title no-translate">
            {{ item.text1 }}
          </h2>
          {% unless item.text2 == '' %}<div class="tt-description no-translate">{{ item.text2 }}</div>{% endunless %}
          {% unless item.default_carousel %}{% unless item.text3 == '' %}<p class="no-translate">{{ item.text3 }}</p>{% endunless %}{% endunless %}
        </div>

        <div class="clockdown-wrapper isMobile">
          {% include 'flash-sale-countdown' %}
          {%- if item.use_title_as_link -%}
            <a href="/collections/{{ collection.handle }}" class="link-see-all" title="{{ item.button_text }}">{{ item.button_text }}</a>
          {%- endif -%}
        </div>

      </div>
    {%- endif -%}

    <!-- MAIN WRAPPER -->
    <div class="collection-wrapper">
      <div class="collection-card-box">
        <div class="flash-sale-card" style="background-image: url({{ item.bg_card_flash_sale | img_url: 'medium' }});">
          <div class="card-box-wrapper">
            <img src="{{ item.logo_card_flash_sale | img_url: 'medium' }}" alt="logo-flash-sale" />
            <div class="isDesktop">
              {% include 'flash-sale-countdown' %}
            </div>
            {%- if item.show_button -%}
            <div class="text-center button-show-all">
              <a href="/collections/{{ collection.handle }}" class="btn btn-border btn-top button-flash-sale">{{ item.button_text }}</a>
            </div>
            {%- endif -%}
          </div>
        </div>
      </div>
      <div class="collection-list-box">
        <!-- CAROUSEL PRODUCT -->
        {%- if item.default_carousel -%}
        {%- assign slider_mode = true -%}
          <div
            class="{% if item.boxed_buttons and item.fullwidth %}slboxedbuttons {% endif %}tt-carousel-flash-sale tt-carousel-products-js row arrow-location-tab tt-alignment-img tt-layout-product-item slick-animated-show-js"
            data-slick='{"slidesToShow": {{ item.toshow }}, "slidesToScroll": {{ item.step }}, "autoplay": {{ item.module_autoplay }}, "autoplaySpeed": {{ item.delay_time }}, "infinite": false}'
            >
            {%- for product in collection.products limit: length -%}
              <div
                class="forsliders-margins"
                data-limoniapps-discountninja-product-handle="{{ product.handle }}"
                data-limoniapps-discountninja-product-collections="{{ product.collections | map: 'handle' | join: ',' }}"
                data-limoniapps-discountninja-product-collectionids="{{ product.collections | map: 'id' | join: ',' }}"
                data-limoniapps-discountninja-product-available="{{ product.available}}"
                data-limoniapps-discountninja-product-price="{{ product.price}}"
                data-limoniapps-discountninja-product-compareatprice="{{ product.compare_at_price_max}}"
                data-limoniapps-discountninja-product-pricevaries="{{ product.price_varies}}"
                data-limoniapps-discountninja-product-pricemin="{{ product.price_min}}"
                data-limoniapps-discountninja-product-tags="{{ product.tags | join: ',' }}"
              >
                <div class="product-card limoniapps-discountninja-collectionbadge" >
                  {%- include "product-grid-item-special" -%}
                </div>
              </div>
            {%- endfor -%}
          </div>
          <div class="mobile-only row tt-layout-product-item{% if item.items_always_in_center %} justify-content-center{% endif %}">
            {%- for product in collection.products limit: length -%}
              <div class="mobile-card col-5 col-md-4 {% if grid == '5' %}col-5-inrow-lg{% else %}col-lg-{{ grid }}{% endif %}"
                data-limoniapps-discountninja-product-handle="{{ product.handle }}"
                data-limoniapps-discountninja-product-collections="{{ product.collections | map: 'handle' | join: ',' }}"
                data-limoniapps-discountninja-product-collectionids="{{ product.collections | map: 'id' | join: ',' }}"
                data-limoniapps-discountninja-product-available="{{ product.available}}"
                data-limoniapps-discountninja-product-price="{{ product.price}}"
                data-limoniapps-discountninja-product-compareatprice="{{ product.compare_at_price_max}}"
                data-limoniapps-discountninja-product-pricevaries="{{ product.price_varies}}"
                data-limoniapps-discountninja-product-pricemin="{{ product.price_min}}"
                data-limoniapps-discountninja-product-tags="{{ product.tags | join: ',' }}"
              >
                <div class="product-card">
                  {%- include "product-grid-item-special" -%}
                </div>
              </div>
            {%- endfor -%}
          </div>
        {%- else -%}
        <div class="row tt-layout-product-item{% if item.items_always_in_center %} justify-content-center{% endif %}" >
          {%- for product in collection.products limit: length -%}
            <div class="col-5 col-md-4 {% if grid == '5' %}col-5-inrow-lg{% else %}col-lg-{{ grid }}{% endif %}"
              data-limoniapps-discountninja-product-handle="{{ product.handle }}"
              data-limoniapps-discountninja-product-collections="{{ product.collections | map: 'handle' | join: ',' }}"
              data-limoniapps-discountninja-product-collectionids="{{ product.collections | map: 'id' | join: ',' }}"
              data-limoniapps-discountninja-product-available="{{ product.available}}"
              data-limoniapps-discountninja-product-price="{{ product.price}}"
              data-limoniapps-discountninja-product-compareatprice="{{ product.compare_at_price_max}}"
              data-limoniapps-discountninja-product-pricevaries="{{ product.price_varies}}"
              data-limoniapps-discountninja-product-pricemin="{{ product.price_min}}"
              data-limoniapps-discountninja-product-tags="{{ product.tags | join: ',' }}"
            >
              {%- include "product-grid-item-special" -%}
            </div>
          {%- endfor -%}
        </div>
        {%- endif -%}
      </div>
    </div>
  </div>
  {% if item.nopaddings %}</div>{% endif %}
</div>

<style>
  .flash-sale-collectioncontainer-indent  {
    margin-top: 33px;
  }
  .flash-sale-collection .limoniapps-discountninja-badge .limoniapps-discountninja-badge-inner {
    border-radius: 4px !important;
    display: inline-flex;
    margin-top: 2px;
    margin-left: 8px;
    padding: 4px 6px;
  }
  .flash-sale-collection .limoniapps-discountninja-badge .limoniapps-discountninja-badge-inner span {
    font-size: 14px !important;
    font-weight: 500;
  }
  .collection-wrapper {
    display: flex;
    align-items: center;
    position: relative;
  }
  .flash-sale-card {
    width: 380px;
    height: 420px;
    background-size: cover;
    border-radius: 16px;
  }
  .collection-list-box {
    width: calc(100% - 300px);
    margin-left: -100px;
  }
  .product-card {
    padding: 16px;
    border: 1px solid #C1E6D6;
    background-color: #fff;
    border-radius: 8px;
    align-items: stretch;
  }
  #product-collection-{{ section.id }} .button-see-collection {
  	min-width: 300px;
    height: 42px;
    border: 1px solid #12784A;
    border-radius: 8px;
    font-weight: 500;
    font-size: 14px;
    line-height: 21px;
    color: #12784A;
    margin-top: 26px;
  }
  #product-collection-{{ section.id }} .button-see-collection:hover {
    background: #12784A;
    color: #fff;
  }
  .custom-block-title .link-see-all {
    color: #12784A;
    display: none;
    font-weight: 500;
  }
  #product-collection-{{ section.id }} .slider-mobile {
    display: none;
    }
  #product-collection-{{ section.id }} .slider-desktop {
    display: block;
  }
  #product-collection-{{ section.id }} .mobile-only {
    display: none;
  }
  .card-box-wrapper {
    width: 280px;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }

  @media (min-width: 576px) {
    .card-box-wrapper {
      width: 280px;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    .btn.btn-border.button-flash-sale {
      border: 1px solid #fff;
      color: #fff;
      text-transform: uppercase;
      margin-top: 16px;
    }
    .tt-carousel-flash-sale {
      margin-top: 0 !important;
    }
    .collection-list-box .arrow-location-tab .slick-prev {
      left: -10px;
    }
    .collection-list-box .arrow-location-tab .slick-arrow {
      top: 45%;
    }
    .collection-list-box .arrow-location-tab .slick-next {
      right: -10px;
    }
  }

  @media (max-width: 575px) {
    .collection-list-box {
      width: 0;
      margin-left: initial;
      position: absolute;
      left: 0;
    }
    .tt-layout-product-item  {
      margin: 0;
      margin-top: 16px;
    }
    .collection-list-box .mobile-card {
      padding-left: 8px;
      padding-right: 8px;
    }
    .collection-list-box .mobile-card:first-child {
      margin-left: 40vw;
    }
    .collection-card-box .button-show-all {
      display: none;
    }
    .flash-sale-card {
      width: 100vw;
      height: 320px;
    }
    .card-box-wrapper {
      width: 40vw;
    }
    .card-box-wrapper img {
      width: 100%;
    }
    #product-collection-{{ section.id }} .button-see-collection {
      display: none;
    }
    #product-collection-{{ section.id }} .tt-layout-product-item .slick-arrow {
      display: none !important;
    }
    #product-collection-{{ section.id }} .tt-layout-product-item .tt-description {
      flex-wrap: wrap;
      white-space: normal;
    }
    #product-collection-{{ section.id }} .tt-price span:first-child {
      color: #12784A;
      width: 100%;
    }
    #product-collection-{{ section.id }} .tt-price {
      text-align: left;
      font-size: 14px;
      font-weight: 600;
      margin-top: 8px;
    }
    #product-collection-{{ section.id }} .tt-price .old-price {
      font-size: 10px;
      font-weight: 300;
      line-height: 15px;
      margin-top: 6px;
    }
    #product-collection-{{ section.id }} .tt-layout-product-item::-webkit-scrollbar {
      width: 0;
      background: transparent;
    }
    #product-collection-{{ section.id }} .tt-layout-product-item::-webkit-scrollbar-thumb {
      background: transparent;
    }
    #product-collection-{{ section.id }} .tt-layout-product-item {
      justify-content: flex-start;
      overflow: auto;
      width: 100vw;
      flex-wrap: nowrap;
      white-space: nowrap;
    }
    .custom-block-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .custom-block-title .link-see-all {
      display: block;
    }
    #product-collection-{{ section.id }} .mobile-only {
      display: flex;
    }
    .flash-sale-collection .custom-block-title {
      flex-direction: column;
      padding-bottom: 8px;
    }
    .flash-sale-collection .tt-block-title .tt-title {
      text-align: left;
      margin-bottom: 4px;
    }
    .clockdown-wrapper {
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .clockdown-wrapper p.flash-sale-title{
      text-transform: capitalize;
      font-size: 10px;
      line-height: 16px;
      color: #424242;
    }
  }
</style>


{% schema %}
  {
    "name": "Flash Sale Products",
	  "class": "index-section",
    "settings": [
      {
        "type": "select",
        "id": "top_offset",
        "label": "Top Offset",
        "default": "normal",
        "options": [
          {
            "value": "none",
            "label": "None"
          },
          {
            "value": "small",
            "label": "Small"
          },
          {
            "value": "normal",
            "label": "Normal"
          }
        ]
      },
      {
      "type": "textarea",
        "id": "custom_classes",
        "label": "Custom css classes",
        "info": "For the custom styles. Add your styles in the theme.css.liquid"
      },
      {
        "type": "checkbox",
        "id": "fullwidth",
        "label": "Fullwidth size",
        "default": false
      },
      {
        "type": "checkbox",
        "id": "nopaddings",
        "label": "No paddings",
        "default": false,
		    "info": "!!! Please use this option with product thumbnail design \"type 2\""
      },
      {
        "type": "checkbox",
        "id": "show_title",
        "label": "Show Title Block",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "title_to_left",
        "label": "Title to left",
        "default": false
      },
      {
        "type": "checkbox",
        "id": "boxed_title",
        "label": "Boxed title when fullwidth",
        "default": false
      },
      {
        "type": "textarea",
        "id": "text1",
        "label": "Title",
        "default": "Flash Sale"
      },
      {
        "type": "textarea",
        "id": "text2",
        "label": "Small description",
		    "info": "Empty field = hide field"
      },
      {
        "type": "textarea",
        "id": "text3",
        "label": "Big description",
		    "info": "Empty field = hide field. Not work with slider mode"
      },
      {
        "type": "header",
        "content": "Show all button"
      },
      {
        "type": "checkbox",
        "id": "use_title_as_link",
        "label": "Use title as link to the collection",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "show_button",
        "label": "Show button",
        "default": false
      },
      {
        "type": "text",
        "id": "button_text",
        "label": "Button text",
		    "default": "SHOW ALL"
      },
      {
        "type": "image_picker",
        "id": "bg_card_flash_sale",
        "label": "Background Card"
      },
      {
        "type": "image_picker",
        "id": "logo_card_flash_sale",
        "label": "Logo Flash Sale Card"
      },
      {
        "type": "header",
        "content": "Products settings"
      },
      {
        "label": "Collection",
        "id": "collection",
        "type": "collection"
      },
      {
        "type": "checkbox",
        "id": "items_always_in_center",
        "label": "Products in center",
        "default": false
      },
      {
        "type": "text",
        "id": "limit",
        "label": "Items Length. Integer",
        "default": "8"
      },
      {
        "type": "select",
        "id": "items",
        "label": "Products In Row",
        "options": [
          { "value": "6", "label": "2" },
          { "value": "4", "label": "3" },
          { "value": "3", "label": "4" },
          { "value": "5", "label": "5" },
          { "value": "2", "label": "6" }
        ],
        "default": "3",
        "info": "For screen size > 1024"
      },
      {
        "type": "header",
        "content": "By Default Carousel"
      },
      {
        "type": "checkbox",
        "id": "default_carousel",
        "label": "Default Carousel",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "boxed_buttons",
        "label": "Boxed buttons when fullwidth",
        "default": false
      },
      {
        "type": "select",
        "id": "toshow",
        "label": "Items in row",
        "options": [
          { "value": "2", "label": "2" },
          { "value": "3", "label": "3" },
          { "value": "4", "label": "4" },
          { "value": "5", "label": "5" },
          { "value": "6", "label": "6" }
        ],
        "default": "3",
        "info": "For screen size > 1024"
      },
      {
        "type": "select",
        "id": "step",
        "label": "Slides To Scroll",
        "default": "1",
        "options": [
          {
            "value": "1",
            "label": "1"
          },
          {
            "value": "2",
            "label": "2"
          },
          {
            "value": "3",
            "label": "3"
          },
          {
            "value": "4",
            "label": "4"
          },
          {
            "value": "5",
            "label": "5"
          },
          {
            "value": "6",
            "label": "6"
          }
        ]
      },
      {
        "type": "checkbox",
        "id": "module_autoplay",
        "label": "Auto-rotate slides",
        "default": false
      },
      {
        "type": "select",
        "id": "delay_time",
        "label": "Change slides every",
        "options": [
          { "value": "5000", "label": "5 seconds" },
          { "value": "6000", "label": "6 seconds" },
          { "value": "7000", "label": "7 seconds" },
          { "value": "8000", "label": "8 seconds" },
          { "value": "9000", "label": "9 seconds" },
          { "value": "10000", "label": "10 seconds" }
        ],
        "default": "7000"
      }
	],
    "presets": [
      {
        "name": "Flash Sale Products",
        "category": "Products"
      }
    ]
  }
{% endschema %}
